<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial; padding: 20px; }
      label, select, input { display: block; margin: 10px 0; }
    </style>
  </head>
  <body>
    <h2>Generador de Seriales</h2>

    <label for="ot">Selecciona una OT:</label>
    <select id="ot" onchange="mostrarInfo()"></select>

    <div id="info"></div>

    <label for="cantidad">Cantidad a entregar:</label>
    <input type="number" id="cantidad" min="1">

    <button onclick="generar()">Generar Seriales</button>

    <div id="resultado"></div>

    <script>
      let datosOTs = [];

      function cargarOTs() {
        google.script.run.withSuccessHandler(function(data) {
          datosOTs = data;
          const select = document.getElementById("ot");
          select.innerHTML = ""; // Limpiar opciones anteriores
          data.forEach(d => {
            const option = document.createElement("option");
            option.value = d.OT;
            option.text = d.OT + " - " + d.CodProd;
            select.appendChild(option);
          });
          mostrarInfo();
        }).obtenerDatosOTs();
      }

      function mostrarInfo() {
        const otSeleccionada = document.getElementById("ot").value;
        const info = datosOTs.find(d => d.OT == otSeleccionada);
        if (info) {
          document.getElementById("info").innerHTML = `
            <strong>Producto:</strong> ${info.DescProd}<br>
            <strong>Cantidad:</strong> ${info.Cant}<br>
            <strong>Pendiente por Producir:</strong> ${info.Pdte}<br>
            <strong>Unidad de Empaque:</strong> ${info.UndEmp}<br><br>
            <label><input type="checkbox" id="chkEntrega"> Entregar</label>
          `;
        }
      }

      function generar() {
        const ot = document.getElementById("ot").value;
        const cantidad = parseInt(document.getElementById("cantidad").value);
        const entregar = document.getElementById("chkEntrega").checked;
        const info = datosOTs.find(d => d.OT == ot);

        if (!entregar) {
          alert("Debes marcar la opción 'Entregar' para continuar.");
          return;
        }

        if (!cantidad || cantidad <= 0) {
          alert("Ingresa una cantidad válida.");
          return;
        }

        google.script.run.withSuccessHandler(function(seriales) {
          document.getElementById("resultado").innerHTML = `
            <p>✅ Se generaron ${seriales.length} seriales.</p>
            <pre>${seriales.join("\\n")}</pre>
          `;
        }).generarSeriales(ot, cantidad, info.UndEmp);
      }


    </script>

  </body>
</html>



